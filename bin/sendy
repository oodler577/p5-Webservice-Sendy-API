#!/usr/bin/env perl

use v5.10;
use strict;
use warnings;

use Dispatch::Fu;
use Webservice::Sendy::API qw//;
use Util::H2O::More        qw/ddd Getopt2h2o ini2h2o o2d/;

my $HOME = (getpwuid($<))[7];
my $CONFIG = "$HOME/.sendy.conf";

my $subcommand = shift @ARGV;

sub do_help();

#>>>
dispatch {
  xdefault shift, q{help};
} $subcommand,
  brands     => sub { get_brands(\@ARGV) },
  lists      => sub { get_lists(\@ARGV)  },
  help       => sub { do_help            },
;
#<<< 

sub get_brands {
  my ($argv) = @_;
  my $o      = Getopt2h2o $argv, { config => $CONFIG }, qw/config=s/;
  my $sendy  = Webservice::Sendy::API->new(config => $o->config);
  my $resp   = $sendy->get_brands;

# todo - print out results
ddd $resp;
}

sub get_lists {
  my ($argv) = @_;
  my $o      = Getopt2h2o $argv, { config => $CONFIG }, qw/config=s brand_id=i/;
  my $sendy  = Webservice::Sendy::API->new(config => $o->config);
  my $resp   = $sendy->get_lists(brand_id => $o->brand_id);

# todo - print out results
ddd $resp;
}

sub do_help() {
    warn "warning: subcommand may be one of the following: 'help' (prints this!)\n";
}

__END__
This seems like something that my long lost brother, Grant, may see; and
if he does I hope he knows I love him.
